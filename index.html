<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Andi (almost@gmail.com, @inductivestep)" />

<meta name="date" content="2020-07-09" />

<title>2020 Russian constitutional referendum</title>

<script src="constitution_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="constitution_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="constitution_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="constitution_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="constitution_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="constitution_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="constitution_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="constitution_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="constitution_files/navigation-1.1/tabsets.js"></script>
<link href="constitution_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="constitution_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">2020 Russian constitutional referendum</h1>
<h4 class="author">Andi (<a href="mailto:almost@gmail.com" class="email">almost@gmail.com</a>, @<a href="https://twitter.com/InductiveStep">inductivestep</a>)</h4>
<h4 class="date">09 July 2020</h4>

</div>


<p>Using <code>rvest</code> to scrape the 2020 Russian constitutional referendum results from Wikipedia, do some sums, and plot them on a choropleth (<code>raster</code> and <code>ggplot</code>). The <a href="https://github.com/InductiveStep/2020-Russian-constitutional-referendum">source is available here</a>.</p>
<div id="load-packages" class="section level2">
<h2>Load packages</h2>
<pre class="r"><code>library(rvest)
library(car)
library(tidyverse)
library(kableExtra)
library(viridis)</code></pre>
</div>
<div id="read-in-the-data-from-a-wikipedia-page" class="section level2">
<h2>Read in the data from a Wikipedia page</h2>
<div id="grab-the-page" class="section level3">
<h3>Grab the page</h3>
<p>This uses a <a href="https://en.wikipedia.org/w/index.php?title=2020_Russian_constitutional_referendum&amp;oldid=966242800">particular revision</a>, not the <a href="https://en.wikipedia.org/wiki/2020_Russian_constitutional_referendum">latest page</a>, so the table doesn’t shift if I rerun the code.</p>
<pre class="r"><code>wp_page &lt;- read_html(&quot;https://en.wikipedia.org/w/index.php?title=2020_Russian_constitutional_referendum&amp;oldid=966242800&quot;)</code></pre>
</div>
<div id="grab-the-table" class="section level3">
<h3>Grab the table</h3>
<p>I got the xpath using the Chrome inspector (see, e.g., <a href="https://medium.com/@kyleake/wikipedia-data-scraping-with-r-rvest-in-action-3c419db9af2d">this page</a>)</p>
<pre class="r"><code>results &lt;- wp_page %&gt;%
  html_node(xpath = &#39;//*[@id=&quot;mw-content-text&quot;]/div/table[10]&#39;) %&gt;%
  html_table(fill = TRUE)
names(results) &lt;- c(&quot;Region&quot;, &quot;Votes_Yes&quot;, &quot;Perc_Yes&quot;, &quot;Votes_No&quot;, &quot;Perc_No&quot;)</code></pre>
<p>Have a look:</p>
<pre class="r"><code>head(results)</code></pre>
</div>
<div id="cleaning" class="section level3">
<h3>Cleaning</h3>
<p>Remove an empty row and other stuff…</p>
<pre class="r"><code>res_clean &lt;- results %&gt;%
  subset(!Region %in% c(&quot;&quot;,
                        &quot;Source: CEC&quot;,
                        &quot;Region&quot;))</code></pre>
<p>Remove the thousand separator commas.</p>
<pre class="r"><code>res_clean %&gt;%
  mutate_at(vars(starts_with(&quot;Votes&quot;)),
            ~ gsub(&quot;,&quot;, &quot;&quot;, .)) -&gt; res_clean</code></pre>
<p>Now transform all the numbers to numerics.</p>
<pre class="r"><code>res_clean %&gt;%
  mutate_at(vars(!matches(&quot;Region&quot;)),
            as.numeric) -&gt; res_clean</code></pre>
<p>Remove those percentages:</p>
<pre class="r"><code>res_clean %&gt;%
  dplyr::select(-c(starts_with(&quot;Perc&quot;))) -&gt; res_clean</code></pre>
<p>Have a peek:</p>
<pre class="r"><code>View(res_clean)</code></pre>
</div>
</div>
<div id="rithmetic" class="section level2">
<h2>’rithmetic</h2>
<p>Total sums:</p>
<pre class="r"><code>Total_Yes &lt;- sum(res_clean$Votes_Yes)
Total_No  &lt;- sum(res_clean$Votes_No)</code></pre>
<p>Percentage voting for the changes.</p>
<pre class="r"><code>Perc_Yes &lt;- 100*Total_Yes / (Total_Yes + Total_No)
Perc_Yes</code></pre>
<pre><code>## [1] 78.55816</code></pre>
<p>Compute the percentages again (more dp):</p>
<pre class="r"><code>res_clean &lt;- res_clean %&gt;%
  mutate(Perc_Yes = 100*Votes_Yes / (Votes_Yes + Votes_No))</code></pre>
</div>
<div id="results" class="section level2">
<h2>Results</h2>
<pre class="r"><code>res_clean %&gt;%
  arrange(Perc_Yes) %&gt;%
  kable(align=&quot;lrrr&quot;, digits = 1)</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
Region
</th>
<th style="text-align:right;">
Votes_Yes
</th>
<th style="text-align:right;">
Votes_No
</th>
<th style="text-align:right;">
Perc_Yes
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Nenets Autonomous Okrug
</td>
<td style="text-align:right;">
9567
</td>
<td style="text-align:right;">
12074
</td>
<td style="text-align:right;">
44.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Yakutia
</td>
<td style="text-align:right;">
204435
</td>
<td style="text-align:right;">
142464
</td>
<td style="text-align:right;">
58.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Kamchatka Krai
</td>
<td style="text-align:right;">
65485
</td>
<td style="text-align:right;">
39406
</td>
<td style="text-align:right;">
62.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Omsk Oblast
</td>
<td style="text-align:right;">
610278
</td>
<td style="text-align:right;">
360348
</td>
<td style="text-align:right;">
62.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Magadan Oblast
</td>
<td style="text-align:right;">
34035
</td>
<td style="text-align:right;">
20090
</td>
<td style="text-align:right;">
62.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Khabarovsk Krai
</td>
<td style="text-align:right;">
271421
</td>
<td style="text-align:right;">
159662
</td>
<td style="text-align:right;">
63.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Murmansk Oblast
</td>
<td style="text-align:right;">
163735
</td>
<td style="text-align:right;">
95095
</td>
<td style="text-align:right;">
63.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Irkutsk Oblast
</td>
<td style="text-align:right;">
529770
</td>
<td style="text-align:right;">
287131
</td>
<td style="text-align:right;">
64.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Tomsk Oblast
</td>
<td style="text-align:right;">
223046
</td>
<td style="text-align:right;">
117232
</td>
<td style="text-align:right;">
65.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Baikonur
</td>
<td style="text-align:right;">
4288
</td>
<td style="text-align:right;">
2248
</td>
<td style="text-align:right;">
65.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Komi Republic
</td>
<td style="text-align:right;">
221113
</td>
<td style="text-align:right;">
115322
</td>
<td style="text-align:right;">
65.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Moscow
</td>
<td style="text-align:right;">
2855547
</td>
<td style="text-align:right;">
1485963
</td>
<td style="text-align:right;">
65.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Arkhangelsk Oblast
</td>
<td style="text-align:right;">
297432
</td>
<td style="text-align:right;">
150935
</td>
<td style="text-align:right;">
66.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Sverdlovsk Oblast
</td>
<td style="text-align:right;">
1132182
</td>
<td style="text-align:right;">
565242
</td>
<td style="text-align:right;">
66.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Altai Republic
</td>
<td style="text-align:right;">
55291
</td>
<td style="text-align:right;">
27433
</td>
<td style="text-align:right;">
66.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Novosibirsk Oblast
</td>
<td style="text-align:right;">
698857
</td>
<td style="text-align:right;">
323674
</td>
<td style="text-align:right;">
68.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Kostroma Oblast
</td>
<td style="text-align:right;">
180846
</td>
<td style="text-align:right;">
83044
</td>
<td style="text-align:right;">
68.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Yaroslavl Oblast
</td>
<td style="text-align:right;">
374053
</td>
<td style="text-align:right;">
168930
</td>
<td style="text-align:right;">
68.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Russians abroad
</td>
<td style="text-align:right;">
99852
</td>
<td style="text-align:right;">
44939
</td>
<td style="text-align:right;">
69.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Udmurtia
</td>
<td style="text-align:right;">
455908
</td>
<td style="text-align:right;">
199121
</td>
<td style="text-align:right;">
69.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Khanty-Mansi Autonomous Okrug
</td>
<td style="text-align:right;">
487750
</td>
<td style="text-align:right;">
212434
</td>
<td style="text-align:right;">
69.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Chelyabinsk Oblast
</td>
<td style="text-align:right;">
1190097
</td>
<td style="text-align:right;">
505597
</td>
<td style="text-align:right;">
70.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Kurgan Oblast
</td>
<td style="text-align:right;">
276378
</td>
<td style="text-align:right;">
117294
</td>
<td style="text-align:right;">
70.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Khakassia
</td>
<td style="text-align:right;">
141381
</td>
<td style="text-align:right;">
59758
</td>
<td style="text-align:right;">
70.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Kaluga Oblast
</td>
<td style="text-align:right;">
338748
</td>
<td style="text-align:right;">
140003
</td>
<td style="text-align:right;">
70.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Krasnoyarsk Krai
</td>
<td style="text-align:right;">
848638
</td>
<td style="text-align:right;">
350687
</td>
<td style="text-align:right;">
70.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Republic of Karelia
</td>
<td style="text-align:right;">
168389
</td>
<td style="text-align:right;">
68304
</td>
<td style="text-align:right;">
71.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Amur Oblast
</td>
<td style="text-align:right;">
258548
</td>
<td style="text-align:right;">
103726
</td>
<td style="text-align:right;">
71.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Perm Krai
</td>
<td style="text-align:right;">
734802
</td>
<td style="text-align:right;">
293643
</td>
<td style="text-align:right;">
71.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Kirov Oblast
</td>
<td style="text-align:right;">
409702
</td>
<td style="text-align:right;">
163247
</td>
<td style="text-align:right;">
71.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Vologda Oblast
</td>
<td style="text-align:right;">
388615
</td>
<td style="text-align:right;">
152983
</td>
<td style="text-align:right;">
71.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Ulyanovsk Oblast
</td>
<td style="text-align:right;">
379056
</td>
<td style="text-align:right;">
148346
</td>
<td style="text-align:right;">
71.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Vladimir Oblast
</td>
<td style="text-align:right;">
419606
</td>
<td style="text-align:right;">
164025
</td>
<td style="text-align:right;">
71.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Novgorod Oblast
</td>
<td style="text-align:right;">
172997
</td>
<td style="text-align:right;">
66616
</td>
<td style="text-align:right;">
72.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Tver Oblast
</td>
<td style="text-align:right;">
410421
</td>
<td style="text-align:right;">
155409
</td>
<td style="text-align:right;">
72.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Smolensk Oblast
</td>
<td style="text-align:right;">
296792
</td>
<td style="text-align:right;">
111247
</td>
<td style="text-align:right;">
72.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Kaliningrad Oblast
</td>
<td style="text-align:right;">
334755
</td>
<td style="text-align:right;">
125341
</td>
<td style="text-align:right;">
72.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Altai Krai
</td>
<td style="text-align:right;">
645603
</td>
<td style="text-align:right;">
241132
</td>
<td style="text-align:right;">
72.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Buryatia
</td>
<td style="text-align:right;">
329208
</td>
<td style="text-align:right;">
121205
</td>
<td style="text-align:right;">
73.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Chuvashia
</td>
<td style="text-align:right;">
426779
</td>
<td style="text-align:right;">
154351
</td>
<td style="text-align:right;">
73.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Orenburg Oblast
</td>
<td style="text-align:right;">
834406
</td>
<td style="text-align:right;">
286720
</td>
<td style="text-align:right;">
74.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Kursk Oblast
</td>
<td style="text-align:right;">
389300
</td>
<td style="text-align:right;">
133471
</td>
<td style="text-align:right;">
74.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Zabaykalsky Krai
</td>
<td style="text-align:right;">
352670
</td>
<td style="text-align:right;">
114010
</td>
<td style="text-align:right;">
75.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Sakhalin Oblast
</td>
<td style="text-align:right;">
189466
</td>
<td style="text-align:right;">
60853
</td>
<td style="text-align:right;">
75.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Mari El
</td>
<td style="text-align:right;">
251831
</td>
<td style="text-align:right;">
77884
</td>
<td style="text-align:right;">
76.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Ivanovo Oblast
</td>
<td style="text-align:right;">
390256
</td>
<td style="text-align:right;">
117846
</td>
<td style="text-align:right;">
76.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Saint Petersburg
</td>
<td style="text-align:right;">
2241963
</td>
<td style="text-align:right;">
624517
</td>
<td style="text-align:right;">
78.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Jewish Autonomous Oblast
</td>
<td style="text-align:right;">
70213
</td>
<td style="text-align:right;">
19430
</td>
<td style="text-align:right;">
78.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Pskov Oblast
</td>
<td style="text-align:right;">
231684
</td>
<td style="text-align:right;">
60626
</td>
<td style="text-align:right;">
79.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Lipetsk Oblast
</td>
<td style="text-align:right;">
479670
</td>
<td style="text-align:right;">
124509
</td>
<td style="text-align:right;">
79.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Ryazan Oblast
</td>
<td style="text-align:right;">
499716
</td>
<td style="text-align:right;">
129104
</td>
<td style="text-align:right;">
79.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Primorsky Krai
</td>
<td style="text-align:right;">
723089
</td>
<td style="text-align:right;">
185629
</td>
<td style="text-align:right;">
79.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Moscow Oblast
</td>
<td style="text-align:right;">
3488197
</td>
<td style="text-align:right;">
888794
</td>
<td style="text-align:right;">
79.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Nizhny Novgorod Oblast
</td>
<td style="text-align:right;">
1505620
</td>
<td style="text-align:right;">
382801
</td>
<td style="text-align:right;">
79.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Leningrad Oblast
</td>
<td style="text-align:right;">
817168
</td>
<td style="text-align:right;">
203833
</td>
<td style="text-align:right;">
80.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Voronezh Oblast
</td>
<td style="text-align:right;">
1070045
</td>
<td style="text-align:right;">
256306
</td>
<td style="text-align:right;">
80.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Oryol Oblast
</td>
<td style="text-align:right;">
372411
</td>
<td style="text-align:right;">
88970
</td>
<td style="text-align:right;">
80.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Samara Oblast
</td>
<td style="text-align:right;">
1346254
</td>
<td style="text-align:right;">
312252
</td>
<td style="text-align:right;">
81.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Chukotka Autonomous Okrug
</td>
<td style="text-align:right;">
18146
</td>
<td style="text-align:right;">
4203
</td>
<td style="text-align:right;">
81.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Belgorod Oblast
</td>
<td style="text-align:right;">
798636
</td>
<td style="text-align:right;">
170172
</td>
<td style="text-align:right;">
82.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Saratov Oblast
</td>
<td style="text-align:right;">
1187697
</td>
<td style="text-align:right;">
244989
</td>
<td style="text-align:right;">
82.9
</td>
</tr>
<tr>
<td style="text-align:left;">
North Ossetia – Alania
</td>
<td style="text-align:right;">
352314
</td>
<td style="text-align:right;">
71856
</td>
<td style="text-align:right;">
83.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Tatarstan
</td>
<td style="text-align:right;">
1943685
</td>
<td style="text-align:right;">
389765
</td>
<td style="text-align:right;">
83.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Tula Oblast
</td>
<td style="text-align:right;">
710765
</td>
<td style="text-align:right;">
138652
</td>
<td style="text-align:right;">
83.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Rostov Oblast
</td>
<td style="text-align:right;">
2099202
</td>
<td style="text-align:right;">
400454
</td>
<td style="text-align:right;">
84.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Volgograd Oblast
</td>
<td style="text-align:right;">
1222903
</td>
<td style="text-align:right;">
232524
</td>
<td style="text-align:right;">
84.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Karachay-Cherkessia
</td>
<td style="text-align:right;">
211163
</td>
<td style="text-align:right;">
37367
</td>
<td style="text-align:right;">
85.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Kalmykia
</td>
<td style="text-align:right;">
124265
</td>
<td style="text-align:right;">
21986
</td>
<td style="text-align:right;">
85.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Adygea
</td>
<td style="text-align:right;">
236686
</td>
<td style="text-align:right;">
41043
</td>
<td style="text-align:right;">
85.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Sevastopol
</td>
<td style="text-align:right;">
183296
</td>
<td style="text-align:right;">
31656
</td>
<td style="text-align:right;">
85.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Penza Oblast
</td>
<td style="text-align:right;">
683244
</td>
<td style="text-align:right;">
114588
</td>
<td style="text-align:right;">
85.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Tyumen Oblast
</td>
<td style="text-align:right;">
748290
</td>
<td style="text-align:right;">
122759
</td>
<td style="text-align:right;">
85.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Stavropol Krai
</td>
<td style="text-align:right;">
1304638
</td>
<td style="text-align:right;">
213467
</td>
<td style="text-align:right;">
85.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Mordovia
</td>
<td style="text-align:right;">
408380
</td>
<td style="text-align:right;">
65931
</td>
<td style="text-align:right;">
86.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bryansk Oblast
</td>
<td style="text-align:right;">
749749
</td>
<td style="text-align:right;">
114009
</td>
<td style="text-align:right;">
86.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Kabardino-Balkaria
</td>
<td style="text-align:right;">
362739
</td>
<td style="text-align:right;">
53795
</td>
<td style="text-align:right;">
87.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Astrakhan Oblast
</td>
<td style="text-align:right;">
463866
</td>
<td style="text-align:right;">
68087
</td>
<td style="text-align:right;">
87.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Kemerovo Oblast
</td>
<td style="text-align:right;">
1522151
</td>
<td style="text-align:right;">
209742
</td>
<td style="text-align:right;">
87.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Tambov Oblast
</td>
<td style="text-align:right;">
583972
</td>
<td style="text-align:right;">
80138
</td>
<td style="text-align:right;">
87.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Ingushetia
</td>
<td style="text-align:right;">
152992
</td>
<td style="text-align:right;">
18972
</td>
<td style="text-align:right;">
89.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Bashkortostan
</td>
<td style="text-align:right;">
2448685
</td>
<td style="text-align:right;">
292701
</td>
<td style="text-align:right;">
89.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Krasnodar Krai
</td>
<td style="text-align:right;">
3219153
</td>
<td style="text-align:right;">
382712
</td>
<td style="text-align:right;">
89.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Yamalo-Nenets Autonomous Okrug
</td>
<td style="text-align:right;">
265237
</td>
<td style="text-align:right;">
30605
</td>
<td style="text-align:right;">
89.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Dagestan
</td>
<td style="text-align:right;">
1352732
</td>
<td style="text-align:right;">
155290
</td>
<td style="text-align:right;">
89.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Crimea
</td>
<td style="text-align:right;">
1104730
</td>
<td style="text-align:right;">
111401
</td>
<td style="text-align:right;">
90.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Tuva
</td>
<td style="text-align:right;">
175698
</td>
<td style="text-align:right;">
5426
</td>
<td style="text-align:right;">
97.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Chechnya
</td>
<td style="text-align:right;">
712909
</td>
<td style="text-align:right;">
14132
</td>
<td style="text-align:right;">
98.1
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>hist(res_clean$Perc_Yes, main = &quot;&quot;, xlab = &quot;Percentage voting Yes&quot;)</code></pre>
<p><img src="constitution_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Log-odds of voting…</p>
<pre class="r"><code>qq_res &lt;- qqPlot(qlogis(res_clean$Perc_Yes / 100), id = list(labels = res_clean$Region),
                 xlab = &quot;Quantiles (normal distribution)&quot;,
                 ylab = &quot;Log-odds voting Yes&quot;)</code></pre>
<p><img src="constitution_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="plot-on-a-map" class="section level2">
<h2>Plot on a map</h2>
<p>The CRAN version of <code>raster</code> didn’t work this end (error loading a DLL), so grab from github…</p>
<pre class="r"><code>#library(devtools)
#install_github(&quot;rspatial/raster&quot;)</code></pre>
<p>… and load:</p>
<pre class="r"><code>library(raster)</code></pre>
<p>Get the Russia country map:</p>
<pre class="r"><code>ru &lt;- getData(&quot;GADM&quot;, country = &quot;RUS&quot;, level=1)</code></pre>
<div id="matching-the-region-names" class="section level3">
<h3>Matching the region names</h3>
<p>Here are the region names in this map (first 10):</p>
<pre class="r"><code>ru@data$NAME_1[1:10]</code></pre>
<pre><code>##  [1] &quot;Adygey&quot;        &quot;Altay&quot;         &quot;Amur&quot;          &quot;Arkhangel&#39;sk&quot; 
##  [5] &quot;Astrakhan&#39;&quot;    &quot;Bashkortostan&quot; &quot;Belgorod&quot;      &quot;Bryansk&quot;      
##  [9] &quot;Buryat&quot;        &quot;Chechnya&quot;</code></pre>
<p>They’re different to the names in the Wikipedia table. How do we match them…?</p>
<p>Fuzzy matching by <a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/adist.html">edit distance</a>…? This almost works for most of them but not quite…</p>
<pre class="r"><code>distances &lt;- adist(gsub(&quot;Oblast|Krai|Okrug|Autonomous&quot;,
                        &quot;&quot;,
                        res_clean$Region),
                   ru@data$NAME_1)
rownames(distances) &lt;- res_clean$Region
colnames(distances) &lt;- ru@data$NAME_1</code></pre>
<p>Often the match is good or close. Other times not so close, e.g., “Sakha” and “Yakutia” are <a href="https://en.wikipedia.org/wiki/Sakha">different names for the same place</a> but aren’t the closest match by edit distance. So, time to export and fix manually:</p>
<pre class="r"><code>write.csv(as.data.frame(distances), &quot;distances.csv&quot;, row.names = T)</code></pre>
<p>I fiddled with this file outside R (using… Excel, for shame) and replaced the best match with -1. Reading in again:</p>
<pre class="r"><code>region_match &lt;- read_csv(&quot;fixed_distances.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   Region = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>Okay, make a lookup table using a DIRTY for-loop:</p>
<pre class="r"><code>wiki_region &lt;- region_match$Region
GADM_region &lt;- rep(NA, length(wiki_region))

for (r in 1:nrow(region_match)) {
  row            &lt;- region_match[r,-1]
  matching_index &lt;- which(row == -1)
  GADM_region[r] &lt;- ifelse(length(matching_index) == 1,
                           colnames(row[which(row == -1)]),
                           NA)
}

matched_region_names &lt;- data.frame(wiki_region, GADM_region)
rm(wiki_region, GADM_region, row, matching_index)</code></pre>
<p>Take a look:</p>
<pre class="r"><code>View(matched_region_names)</code></pre>
<p>No matches for Baikonur (the cosmodrome), Crimea or Sevastopol (which are Ukraine), or “Russians abroad” (that ain’t no oblast).</p>
</div>
<div id="glue-together" class="section level3">
<h3>Glue together</h3>
<pre class="r"><code>for_merge &lt;- matched_region_names
names(for_merge)[1] &lt;- &quot;Region&quot;
for_map &lt;- left_join(res_clean, for_merge)</code></pre>
<pre><code>## Joining, by = &quot;Region&quot;</code></pre>
<p>Now select the bits we want to plot on a map - the region name and percentages:</p>
<pre class="r"><code>for_map &lt;- for_map %&gt;%
  dplyr::select(GADM_region, Perc_Yes)
names(for_map)[1] = &quot;id&quot;</code></pre>
</div>
<div id="plot-a-map" class="section level3">
<h3>Plot a map</h3>
<p>This was more complicated than surely it needs to be…</p>
<pre class="r"><code>library(broom)
library(gpclib)
library(maptools)
library(mapproj)
gpclibPermit()</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>ru_df &lt;- tidy(ru, region = &quot;NAME_1&quot;)</code></pre>
<p>This doesn’t look good: “support for gpclib will be withdrawn from maptools at the next major release”.</p>
<p>But <code>tidy</code> worked:</p>
<pre class="r"><code>head(ru_df)</code></pre>
<pre><code>## # A tibble: 6 x 7
##    long   lat order hole  piece group    id    
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fct&gt; &lt;fct&gt;    &lt;chr&gt; 
## 1  39.7  44.0     1 FALSE 1     Adygey.1 Adygey
## 2  39.7  44.0     2 FALSE 1     Adygey.1 Adygey
## 3  39.7  44.0     3 FALSE 1     Adygey.1 Adygey
## 4  39.7  44.0     4 FALSE 1     Adygey.1 Adygey
## 5  39.7  44.1     5 FALSE 1     Adygey.1 Adygey
## 6  39.7  44.1     6 FALSE 1     Adygey.1 Adygey</code></pre>
<p>Glue the percentages on.</p>
<pre class="r"><code>ru_df_vals &lt;- left_join(ru_df, for_map)
ru_df_vals$region &lt;- ru_df_vals$id # to prevent a message later...</code></pre>
<p>Finally, plot…!</p>
<pre class="r"><code>ggplot(ru_df_vals, aes(long, lat)) +
  geom_map(map = ru_df_vals,
           aes(map_id = id, fill = Perc_Yes),
           color = &quot;gray&quot;,
           show.legend = T) +
  theme_void() +
  theme(legend.position=&quot;bottom&quot;) +
  coord_map(&quot;azequalarea&quot;) + 
  xlim(15,190) +
  ylim(40,83) +
  labs(fill = &quot;% voting yes&quot;) +
  scale_fill_viridis(option = &quot;magma&quot;, direction = -1)</code></pre>
<p><img src="constitution_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>The <code>xlim</code>, <code>ylim</code> and <code>coord_map</code> options were helped along by a <a href="https://stackoverflow.com/a/37567832/416656">stack overflow comment</a>.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
